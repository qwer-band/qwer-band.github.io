<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
	<script src="//cdn.jsdelivr.net/npm/phaser@3.24.1/dist/phaser.js"></script>
    <style>
	  @font-face {
		font-family: 'CWDangamAsac-Bold';
		src: url('https://fastly.jsdelivr.net/gh/projectnoonnu/noonfonts_2108@1.1/CWDangamAsac-Bold.woff') format('woff');
		font-weight: normal;
		font-style: normal;
	  }
      body {
        margin: 0;
		transition: all 1s ease-in;
		font-family: "CWDangamAsac-Bold", serif
      }
	  body.start{
		transition: none;
	  }
	  ul{
		list-style: none;
		margin: 0;
		padding: 0;
	  }
	  #scoreBoard {
		position: absolute;
		font-size: 2.4em;
		width: 100vw;
		height: 100vh;
		align-items: center;
		justify-content: center;
		display: none;
	  }
	  #scoreBoard ul{
	    display: inline-block;
		background: #fff;
		border: 1px solid;
		border-radius: 6px;
		padding: 30px;
	  }
	  #scoreBoard ul li{
		display: flex;
		flex-direction: row;
		align-items: center;
		justify-content: center;
	  }
	  #scoreBoard span{
		display: flex;
		text-align: center;
		justify-content: center;
		align-items: center;
	  }
	  #scoreBoard span:nth-child(4n+1){
		width: 2em;
	  }
	  #scoreBoard span:nth-child(4n+2){
		width: 4em;
	  }
	  #scoreBoard span:nth-child(4n+3){
		width: 4em;
	  }
	  #scoreBoard span:nth-child(4n){
		width: 10em;
	  }
	  #inputPhone{
	    height: 30px;
	    width: 250px;
		font-size: 0.8em;
	  }
    </style>
  </head>
  <body class="start">
  	<div id="scoreBoard">
		<ul>
			<li>
				<span>등수</span>
				<span>점수</span>
				<span>시간</span>
				<span>번호</span>
			</li>
		</ul>
	</div>
  <script type="text/javascript">
	class PreloadScene extends Phaser.Scene {

	  constructor() {
		super('PreloadScene');
	  }

	  preload() {
		this.load.audio('jump', 'assets/jump.mp3');
		this.load.audio('hit', 'assets/hit.m4a');
		this.load.audio('reach', 'assets/reach.m4a');
		this.load.audio('run', 'assets/run.mp3');

		this.load.image('ground-0', 'assets/ground-0.png');
		this.load.image('ground-1', 'assets/ground-1.png');
		this.load.image('ground-2', 'assets/ground-2.png');
		this.load.image('cloud-0-0', 'assets/cloud-0-0.png');
		this.load.image('cloud-0-1', 'assets/cloud-0-1.png');
		this.load.image('cloud-0-2', 'assets/cloud-0-2.png');
		this.load.image('cloud-0-3', 'assets/cloud-0-3.png');
		this.load.image('cloud-1-0', 'assets/cloud-1-0.png');
		this.load.image('cloud-1-1', 'assets/cloud-1-1.png');
		this.load.image('cloud-1-2', 'assets/cloud-1-2.png');
		this.load.image('cloud-1-3', 'assets/cloud-1-3.png');
		this.load.image('cloud-2-0', 'assets/cloud-2-0.png');
		this.load.image('cloud-2-1', 'assets/cloud-2-1.png');
		this.load.image('cloud-2-2', 'assets/cloud-2-2.png');
		this.load.image('cloud-2-3', 'assets/cloud-2-3.png');
		this.load.image('donut-0', 'assets/donut-0.png');
		this.load.image('donut-1', 'assets/donut-1.png');
		this.load.image('donut-2', 'assets/donut-2.png');
		this.load.image('dino-idle', 'assets/siyeon-idle.png');
		this.load.image('dino-hurt', 'assets/siyeon-hurt.png');
		this.load.image('restart', 'assets/restart.png');
		this.load.image('game-over', 'assets/game-over.png');
		this.load.image('cloud', 'assets/cloud.png');
		this.load.image('sun', 'assets/sun.png');
		this.load.image('sunset', 'assets/sunset.png');
		this.load.image('moon', 'assets/moon.png');
		this.load.image('star', 'assets/star.png');
		this.load.image('memo', 'assets/memo.png');
		this.load.image('wheel', 'assets/wheel.png');
		this.load.image('start', 'assets/start.png');
		this.load.image('shadow', 'assets/shadow.png');

		/*this.load.spritesheet('donut', 'assets/coin.png', {
		  frameWidth: 24,
		  frameHeight: 24
		});*/

		/*this.load.spritesheet('donut-hide', 'assets/coin-hide.png', {
		  frameWidth: 24,
		  frameHeight: 77
		});*/

		/*this.load.spritesheet('dino', 'assets/dino-run.png', {
		  frameWidth: 88,
		  frameHeight: 94
		});*/

		this.load.spritesheet('dino', 'assets/siyeon-run.png', {
		  frameWidth: 223,
		  frameHeight: 320
		});

		this.load.spritesheet('siyeon-jump', 'assets/siyeon-jump.png', {
		  frameWidth: 270,
		  frameHeight: 300
		});

		this.load.spritesheet('dino-down', 'assets/dino-down.png', {
		  frameWidth: 118,
		  frameHeight: 94
		});

		this.load.spritesheet('enemy-bird', 'assets/enemy-bird.png', {
		  frameWidth: 92,
		  frameHeight: 77
		});

		this.load.spritesheet('fly-pigeon', 'assets/obstacle-0.png', {
		  frameWidth: 114,
		  frameHeight: 165
		});

		this.load.image('obstacle-1', 'assets/obstacle-1.png');
		this.load.image('obstacle-2', 'assets/obstacle-2.png');
		this.load.image('obstacle-3', 'assets/obstacle-3.png');
	  }

	  create() {
		this.scene.start('PlayScene');
	  }
	}

	function isMobile() {return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);}

	class PlayScene extends Phaser.Scene {

	  constructor() {
		super('PlayScene');
	  }

	  create() {
		const { height, width } = this.game.config;
		//this.CHARACTER_HEIGHT = 92;
		this.CHARACTER_WIDTH = 223;
		this.CHARACTER_HEIGHT = 320;
		this.gameSpeed = 10;
		this.isGameRunning = false;
		this.respawnTime = 0;
		this.donutRespawn = false;
		this.score = 0;
		this.scoreDelay = 1000/10;
		this.donut = 0;
		this.donutPoint = 10;
		this.groundPositionY = 185;
		this.type = 0;

		this.physics.pause();

		this.pressEnterText = this.add.text(width / 2, height / 2 + 200, "00000", {fill: "#000000", font: '900 40px CWDangamAsac-Bold', resolution: 5})
		  .setOrigin(0.5, 0.5)
		  .setDepth(3)
		  .setText(isMobile() ? 'touch screen' : 'press enter');

		this.startImage = this.add.image(0, 0, 'start').setDepth(2).setOrigin(0, 0);

		this.jumpSound = this.sound.add('jump', {volume: 0.2});
		this.hitSound = this.sound.add('hit', {volume: 0.2});
		this.reachSound = this.sound.add('reach', {volume: 0.2});
		this.runSound = this.sound.add('run', {volume: 0.2});

		this.startTrigger = this.physics.add.sprite(172, height - 300).setOrigin(0, 1).setImmovable();

		this.initEnvironment();
		
		this.dino = this.physics.add.sprite(170, 400, 'dino-idle')
		  .setCollideWorldBounds(true)
		  .setGravityY(5000)
		  .setBodySize(this.CHARACTER_WIDTH * 0.5, this.CHARACTER_HEIGHT, true)
		  .setDepth(1)
		  .setOrigin(0, 0);

		this.dino.body.offset.y = -50;
		//this.dino.body.setSize(this.dino.width, this.dino.height, true);

		this.physics.add.collider(this.dino, this.platform);

		this.shadow = this.physics.add.sprite(172, 833, 'shadow').setOrigin(0, 0);

		this.gameOverScreen = this.add.container(0, 0).setAlpha(0)
		//this.gameOverText = this.add.image(0, 0, 'game-over');
		//this.restart = this.add.image(0, 80, 'restart').setInteractive();
		this.gameOverText = this.add.text(width / 2, height / 2, "00000", {fill: "#000000", font: '900 60px CWDangamAsac-Bold', resolution: 5})
		  .setOrigin(0.5, 0.5)
		  .setText('G A M E  O V E R');
		this.gameOverScreen.add([
			this.gameOverText
		]);

		this.obsticles = this.physics.add.group();
		this.donuts = this.physics.add.group();

		this.initAnims();
		this.initStartTrigger();
		this.initColliders();
		this.handleInputs();
		this.handleScore();
	  }

	  initEnvironment(type = 0){
		const { height, width } = this.game.config;

		document.querySelector("body").style.background = "#a5dde2";

		this.sun = this.add.image(700, -360, 'sun').setOrigin(0, 0);
		this.sunset = this.add.image(700, 30, 'sunset').setOrigin(0, 0);
		this.moon = this.add.image(700, -360, 'moon').setOrigin(0, 0);
		this.star = this.add.image(0, 0, 'star').setOrigin(0, 0);
		this.memo = this.add.image(0, 0, 'memo').setOrigin(0, 0);
		this.wheel = this.add.image(0, 0, 'wheel').setOrigin(0, 0);

		this.sunset.setAlpha(0);
		this.moon.setAlpha(0);
		this.star.setAlpha(0);
		this.wheel.setAlpha(0);

		this.ground = this.add.tileSprite(0, height - 250, 250, 0, `ground-${type}`).setOrigin(0, 0);
		this.platform = this.physics.add.existing(this.ground, true);

		this.environment = this.add.group();
		this.environment.addMultiple([
			this.add.image(280, this.cloudHeight(320), `cloud-${type}-${Math.floor(Math.random() * 4)}`),
			this.add.image(width / 1.8, this.cloudHeight(320), `cloud-${type}-${Math.floor(Math.random() * 4)}`),
			this.add.image((width / 1.1), this.cloudHeight(320), `cloud-${type}-${Math.floor(Math.random() * 4)}`),
		]);
		this.environment.setAlpha(0);

		this.scoreText = this.add.text(width, 0, "00000", {fill: "#000000", font: '900 40px CWDangamAsac-Bold', resolution: 5})
		  .setOrigin(1, 0);

		this.scoreLabel = this.add.text(0, 0, "00000", {fill: "#000000", font: '900 40px CWDangamAsac-Bold', resolution: 5})
		  .setOrigin(1, 0)
		  .setText('score');

		this.donutScoreText = this.add.text(0, 0, "00000", {fill: "#000000", font: '900 40px CWDangamAsac-Bold', resolution: 5})
		  .setOrigin(1, 0)
		  .setText('score');

		this.donutScoreImg = this.add.image(1300, 60, 'donut-0');

		this.scoreText.x = 1820;
		this.scoreText.y = 40;
		this.scoreLabel.y = 40;
		this.donutScoreText.y = 40;
		this.donutScoreImg.setScale(.6)
	  }

	  cloudHeight(height){
		return height + ((1 * (Math.floor(Math.random() * 2)) * -2 + 1) * 50);
	  }

	  passTime(type){
		if(this.type !== type){
			this.type = type;

			switch(type){
				case 0:
					document.querySelector("body").style.background = "#a5dde2";
					this.scoreText.setColor("#000000");
					this.scoreLabel.setColor("#000000");
					this.donutScoreText.setColor("#000000");

					this.sun.setAlpha(1);
					this.memo.setAlpha(1);
					this.sunset.setAlpha(0);
					this.moon.setAlpha(0);
					this.star.setAlpha(0);
					this.wheel.setAlpha(0);

					this.sun.x = 700;
					this.sun.y = -360;

					break;
				case 1:
					document.querySelector("body").classList.remove("start")
					document.querySelector("body").style.background = "#e1895e";
					this.scoreText.setColor("#000000");
					this.scoreLabel.setColor("#000000");
					this.donutScoreText.setColor("#000000");

					this.sun.setAlpha(0);
					this.memo.setAlpha(0);
					this.sunset.setAlpha(1);
					this.moon.setAlpha(0);
					this.star.setAlpha(0);
					this.wheel.setAlpha(1);

					this.sun.x = 700;
					this.sun.y = -360;
					this.memo.x = 0;
					this.memo.y = 0;

					break;
				case 2:
					document.querySelector("body").style.background = "#110c22";
					this.scoreText.setColor("#c5c5c5");
					this.scoreLabel.setColor("#c5c5c5");
					this.donutScoreText.setColor("#c5c5c5");

					this.sun.setAlpha(0);
					this.memo.setAlpha(0);
					this.sunset.setAlpha(0);
					this.moon.setAlpha(1);
					this.star.setAlpha(1);
					this.wheel.setAlpha(0);

					this.sunset.x = 700;
					this.sunset.y = 30;
					this.memo.x = 0;
					this.memo.y = 0;

					break;
			}

			this.environment.getChildren().forEach(env => {
			  env.setTexture(`cloud-${type}-${Math.floor(Math.random() * 4)}`);
			});
		}
	  }

	  initColliders() {
		this.physics.add.collider(this.dino, this.obsticles, () => {
		  this.physics.pause();
		  this.isGameRunning = false;
		  this.anims.pauseAll();
		  this.dino.setTexture('dino-hurt');
		  //this.shadow.setAlpha(0);
		  this.respawnTime = 0;
		  this.gameSpeed = 10;
		  this.gameOverScreen.setAlpha(1);
		  this.score = 0;
		  this.hitSound.play();
		  this.runSound.stop();

		  document.querySelector("body").classList.add("start");

		  let score = {
			  _id: crypto.randomUUID(),
			  time: Date.now() - this.startTime,
			  score: Number(this.donut),
			  phone: null
		  }

		  insertRank(score);
		  //scoreUI(true, score);
		}, null, this);

		this.physics.add.overlap(this.dino, this.donuts, (dino, donut) => {
			donut.disableBody(true, true);

			let type = Number(donut.texture.key.replace("donut-", "")) + 1;

			//let obsticle = this.donuts.create(donut.x, donut.y, `donut`).setOrigin(0, 1);
			//let obsticle = this.physics.add.sprite(donut.x, donut.y, `donut`).setOrigin(0, 1);
			//obsticle.play('donut-hide-anim', 1);

			//donut increase
			this.donut = this.donut + type;

			//this.reachSound.play();			
		}, null, this);
	  }

	  initStartTrigger() {
		const { width, height } = this.game.config;
		this.physics.add.overlap(this.startTrigger, this.dino, () => {
		  if (this.startTrigger.y === 10) {
			this.startTrigger.body.reset(0, height);
			return;
		  }

		  this.startTrigger.disableBody(true, true);

		  const startEvent = this.time.addEvent({
			delay: 1000/60,
			loop: true,
			callbackScope: this,
			callback: () => {
			  this.startTime = new Date();
			  this.dino.setVelocityX(80);
			  this.shadow.setVelocityX(80);
			  this.dino.play('dino-run', 1);
			  this.runSound.play();

			  if (this.ground.width < width) {
				this.ground.width += 17 * 2;
			  }

			  if (this.ground.width >= 1000) {
				this.ground.width = width;
				this.isGameRunning = true;
				this.dino.setVelocityX(0);
				this.shadow.setVelocityX(0);
				this.scoreText.setAlpha(1);
				this.environment.setAlpha(1);
				startEvent.remove();

				//this.scale.startFullscreen();
			  }
			}
		  });
		}, null, this);

		//this.dino.body.offset.y = -50;
	  }

	  initAnims() {
		/*this.anims.create({
		  key: 'dino-run',
		  frames: this.anims.generateFrameNumbers('dino', {start: 2, end: 3}),
		  frameRate: 10,
		  repeat: -1
		});*/

		this.anims.create({
		  key: 'dino-run',
		  frames: this.anims.generateFrameNumbers('dino', {start: 0, end: 5}),
		  frameRate: 12,
		  repeat: -1
		});

		this.anims.create({
		  key: 'siyeon-jump',
		  frames: this.anims.generateFrameNumbers('siyeon-jump', {start: 0, end: 7}),
		  frameRate: 10,
		  repeat: 0
		});

		this.anims.create({
		  key: 'dino-down-anim',
		  frames: this.anims.generateFrameNumbers('dino-down', {start: 0, end: 1}),
		  frameRate: 10,
		  repeat: -1
		});

		this.anims.create({
		  key: 'enemy-dino-fly',
		  frames: this.anims.generateFrameNumbers('enemy-bird', {start: 0, end: 1}),
		  frameRate: 6,
		  repeat: -1
		});

		this.anims.create({
		  key: 'donut-rotate',
		  frames: this.anims.generateFrameNumbers('donut', {start: 0, end: 6}),
		  frameRate: 12,
		  repeat: -1
		});

		this.anims.create({
		  key: 'donut-hide-anim',
		  frames: this.anims.generateFrameNumbers('donut-hide', {start: 0, end: 6}),
		  frameRate: 36,
		  //repeat: -1
		  hideOnComplete: true
		});

		this.anims.create({
		  key: 'obstacle-0',
		  frames: this.anims.generateFrameNumbers('fly-pigeon', {start: 0, end: 2}),
		  frameRate: 12,
		  repeat: -1
		});
	  }

	  handleScore() {
		this.time.addEvent({
		  delay: this.scoreDelay,
		  loop: true,
		  callbackScope: this,
		  callback: () => {
			if (!this.isGameRunning) { return; }

			/*this.score++;
			this.gameSpeed += 0.01

			if (this.score % 100 === 0) {
			  this.reachSound.play();

			  this.tweens.add({
				targets: this.scoreText,
				duration: 100,
				repeat: 3,
				alpha: 0,
				yoyo: true
			  })
			}

			const score = Array.from(String(this.score + (this.donut * this.donutPoint)), Number);
			for (let i = 0; i < 5 - String(score).length; i++) {
			  score.unshift(0);
			}

			this.scoreText.setText(score.join(''));*/

			this.gameSpeed += 0.01;

			let score = Array.from(String(Math.floor((Date.now() - this.startTime) / 1000)), Number);
			for (let i = 0; i < 5 - String(score).length; i++) {
			  score.unshift(0);
			}

			this.scoreText.setText(score.join(''));

			score = Array.from(String(this.donut), Number);
			for (let i = 0; i < 5 - String(score).length; i++) {
			  score.unshift(0);
			}
			this.donutScoreText.setText(score.join(''));

			this.scoreLabel.x = this.scoreText.x - this.scoreText.width - 30;
			this.donutScoreText.x = this.scoreLabel.x - this.scoreLabel.width - 70;
			this.donutScoreImg.x = this.donutScoreText.x - this.donutScoreText.width - 60;
		  }
		});
	  }

	  handleInputs() {
		/*this.restart.on('pointerdown', () => {
		  this.dino.setVelocityY(0);
		  this.dino.body.height = 92;
		  this.dino.body.offset.y = 0;
		  this.physics.resume();
		  this.obsticles.clear(true, true);
		  this.donuts.clear(true, true);
		  this.isGameRunning = true;
		  this.gameOverScreen.setAlpha(0);
		  this.anims.resumeAll();
		});*/

		this.input.on("pointerdown", () => {
		  this.pressEnterText.setAlpha(0);
		  this.startImage.setAlpha(0);

		  if(this.isGameRunning){
			if (!this.dino.body.onFloor() || this.dino.body.velocity.x > 0) { return; }

			this.jumpSound.play();
			this.dino.play('siyeon-jump', 1);
			this.dino.body.height = this.CHARACTER_HEIGHT;
			//this.dino.body.offset.y = this.groundPositionY;
			this.dino.setVelocityY(-2000);
			this.dino.setTexture('dino', 0);
			this.jump = true;
			this.runSound.stop();
		  }
		  else{
			this.startTime = Date.now();
			this.type = undefined;
			this.dino.setVelocityY(0);
			this.dino.body.height = this.CHARACTER_HEIGHT;
			//this.dino.body.offset.y = this.groundPositionY;
			this.physics.resume();
			this.obsticles.clear(true, true);
			this.donuts.clear(true, true);
			this.isGameRunning = true;
			this.gameOverScreen.setAlpha(0);
			this.anims.resumeAll();
			this.shadow.setAlpha(1);
			this.donut = 0;

			scoreUI(false);
		  }
		});

		this.input.keyboard.on('keydown_ENTER', () => {
		  this.pressEnterText.setAlpha(0);
		  this.startImage.setAlpha(0);

		  if(this.isGameRunning){
			if (!this.dino.body.onFloor() || this.dino.body.velocity.x > 0) { return; }

			this.jumpSound.play();
			this.dino.play('siyeon-jump', 1);
			this.dino.body.height = this.CHARACTER_HEIGHT;
			//this.dino.body.offset.y = this.groundPositionY;
			this.dino.setVelocityY(-2000);
			this.dino.setTexture('dino', 0);
			this.jump = true;
			this.runSound.stop();
		  }
		  else{
			this.startTime = Date.now();
			this.type = undefined;
			this.dino.setVelocityY(0);
			this.dino.body.height = this.CHARACTER_HEIGHT;
			//this.dino.body.offset.y = this.groundPositionY;
			this.physics.resume();
			this.obsticles.clear(true, true);
			this.donuts.clear(true, true);
			this.isGameRunning = true;
			this.gameOverScreen.setAlpha(0);
			this.anims.resumeAll();
			this.shadow.setAlpha(1);
			this.donut = 0;
			this.runSound.play();

			scoreUI(false);
		  }
		});

		this.input.keyboard.on('keydown_DOWN', () => {
		  if (!this.dino.body.onFloor() || !this.isGameRunning) { return; }

		  this.dino.body.height = 58;
		  this.dino.body.offset.y = 34;
		});

		this.input.keyboard.on('keyup_DOWN', () => {
		  if ((this.score !== 0 && !this.isGameRunning)) { return; }

		  this.dino.body.height = 92;
		  this.dino.body.offset.y = 0;
		});
	  }

	  placeObstacle() {
		/*const obsticleNum = Math.floor(Math.random() * 7) + 1;
		const distance = Phaser.Math.Between(600, 900);

		let obsticle;
		if (obsticleNum > 6) {
		  const enemyHeight = [20, 50];
		  obsticle = this.obsticles.create(this.game.config.width + distance, this.game.config.height - 250 - enemyHeight[Math.floor(Math.random() * 2)], `enemy-bird`)
			.setOrigin(0, .5);
		  obsticle.play('enemy-dino-fly', 1);
		  obsticle.body.height = obsticle.body.height / 1.5;
		} else {
		  obsticle = this.obsticles.create(this.game.config.width + distance, this.game.config.height - 250, `obsticle-${obsticleNum}`)
			.setOrigin(0, .5);
		}*/

		const obstacleNum = Math.floor(Math.random() * 4);
		const distance = Phaser.Math.Between(600, 900);
		let obstacle;

		if(obstacleNum === 0){
			obstacle = this.obsticles.create(this.game.config.width + distance, 360, `fly-pigeon`)
				.setOrigin(0, .5);

			obstacle.play('obstacle-0', 1);
			obstacle.body.height = obstacle.body.height / 2.5;
		}
		else{
			obstacle = this.obsticles.create(this.game.config.width + distance, this.game.config.height - 250, `obstacle-${obstacleNum}`)
				.setOrigin(0, .5);
		}

		obstacle.setImmovable();
	  }

	  placeDonut() {
		const distance = Phaser.Math.Between(600, 900);

		let obsticle = this.donuts.create(this.game.config.width + distance, /*322.5*/375, `donut-${Math.floor(Math.random() * 3)}`)
			.setOrigin(0, 0);
	  }

	  update(time, delta) {
		if (!this.isGameRunning) { return; }

		this.ground.tilePositionX += this.gameSpeed;
		Phaser.Actions.IncX(this.obsticles.getChildren(), -this.gameSpeed);
		Phaser.Actions.IncX(this.donuts.getChildren(), -this.gameSpeed);
		Phaser.Actions.IncX(this.environment.getChildren(), -2);
		if(this.type === 0){
			Phaser.Actions.IncY([this.sun], 0.3);
			Phaser.Actions.IncX([this.memo], -0.3);
		}
		else if(this.type === 1){
			Phaser.Actions.IncY([this.sunset], 0.3);
			Phaser.Actions.IncX([this.wheel], -0.3);
		}

		this.respawnTime += delta * this.gameSpeed * 0.08;

		if(this.respawnTime >= 814 && !this.donutRespawn){
			this.donutRespawn = true;

			this.placeDonut();
		}
		if (this.respawnTime >= 2030) {
		  this.placeObstacle();
		  this.respawnTime = 0;

		  this.placeDonut();
		  this.donutRespawn = false;
		}

		this.obsticles.getChildren().forEach(obsticle => {
		  if (obsticle.getBounds().right < 0) {
			this.obsticles.killAndHide(obsticle);
		  }
		});

		this.environment.getChildren().forEach(env => {
		  if (env.getBounds().right < 0) {
			env.x = this.game.config.width + 30;
			env.y = this.cloudHeight(320);
		  }
		});

		if (this.dino.body.y < 500) {
			if(this.jump){
				this.jump = false;
				this.jumping = true;
				this.dino.anims.stop();
				this.dino.play('siyeon-jump', 1);
			}
		}
		else {
			if(this.jumping){
				this.jumping = false;
				this.dino.anims.stop();
				this.dino.play('dino-run', true);
				//this.runSound.stop();
				this.runSound.play();
			}
		}

		if(Math.floor(((new Date()) - this.startTime) / 10000) < 3){
			this.passTime(Math.floor(((new Date()) - this.startTime) / 10000));
		}
	  }
	}

	function scoreUI(visibility, myScore){
		if(visibility){
			let rank = getRank();
			let place = 0;
			let input = "<input id='inputPhone' type='number' autocomplete=off maxlength='11' placeholder='11자리 휴대폰번호를 입력해 주세요.'>";

			document.querySelectorAll("#scoreBoard>ul>li.score").forEach(item => item.remove());

			for(let score of rank){
				let phone = score.phone;
				let minute = parseInt(score.time / 6000).toString();
				let second = (score.time % 6000 / 1000).toFixed(3);

				if(phone){
					phone = [...score.phone].fill("*",3,score.phone.length-4).join("");
				}
				else {
					phone = "";
				}

				minute = minute.padStart(2, "0");
				second = second.split(".")[0].padStart(2, "0") + "." + second.split(".")[1].padEnd(3, "0");

				place++;

				$("#scoreBoard>ul").insertAdjacentHTML(
					"beforeend",
					`<li class="score">
						<span>${place}</span>
						<span>${score.score}</span>
						<span>${minute + ":" + second}</span>
						<span>${score._id === myScore._id ? input : phone}</span>
					</li>`);
			}

			if($("#inputPhone")){
				$("#inputPhone").addEventListener("keydown", e => {
					if (e.which == 13) {
						let phone = $("#inputPhone").value;
						
						if(phone && phone.length > 0){
							myScore.phone = phone;

							updateRank(myScore);
						}
					}
				});
			}

			$("#scoreBoard").style.display = "flex";

			if($("#inputPhone")){
				$("#inputPhone").focus();
			}
		}
		else{
			$("#scoreBoard").style.display = "none";
		}
	}

	function getRank(){
		let rank = JSON.parse(localStorage.getItem("rank"));

		rank.sort((a, b) => b.score - a.score || b.time - a.time);

		return rank.slice(0, 10);
	}

	function insertRank(score){
		let rank = localStorage.getItem("rank");

		if(!rank){
			rank = [];
		}
		else{
			rank = JSON.parse(rank);
		} 

		rank.push(score);

		localStorage.setItem("rank", JSON.stringify(rank));
	}

	function updateRank(myScore){
		let rank = JSON.parse(localStorage.getItem("rank"));

		for(let score of rank){
			if(score._id === myScore._id){
				score.time = myScore.time;
				score.score = myScore.score;
				score.phone = myScore.phone;

				break;
			}
		}

		localStorage.setItem("rank", JSON.stringify(rank));
	}

	function __querySelector(selector){
		let elements = document.querySelectorAll(selector);

		if(elements.length === 0){
			elements = null;
		}
		else if(elements.length === 1){
			elements = elements[0];
		}

		return elements;
	}

	const config = {
		type: Phaser.AUTO,
		pixelArt: true,
		transparent: true,
		scale: {
			mode: Phaser.Scale.FIT,
			autoCenter: Phaser.Scale.CENTER_BOTH,
			width: 1920,
			height: 1080
		},
		physics: {
			default: 'arcade',
			arcade: {
				debug: false
			}
		},
		scene: [PreloadScene, PlayScene]
	};

	let game = new Phaser.Game(config);

	$ = __querySelector;
  </script>
  </body>
</html>
